<!DOCTYPE html>
<html>
<head>
    <title>ESP32-CAM AI Scanner</title>
    <script>
        window.env = { hardware_concurrency: () => navigator.hardwareConcurrency || 4 };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
</head>
<body>
    <h1>ESP32-CAM Object Classifier</h1>
    
    <div style="position: relative;">
        <img id="stream" src="http://192.168.0.100/stream" crossorigin="anonymous" width="400">
        <canvas id="overlay" style="position: absolute; left: 0; top: 0;"></canvas>
    </div>

    <h2 id="status">Loading AI Model...</h2>
    <div id="predictions"></div>

    <script>
        const img = document.getElementById('stream');
        const status = document.getElementById('status');
        const predictionsDiv = document.getElementById('predictions');

        // Load the COCO-SSD Model (Common Objects in Context)
        async function loadModel() {
            const model = await cocoSsd.load();
            status.innerText = "AI Model Ready - Scanning...";
            detectObjects(model);
        }

        async function detectObjects(model) {
            // Predict what's in the image frame
            const predictions = await model.detect(img);
            
            predictionsDiv.innerHTML = "";
            predictions.forEach(prediction => {
                const p = document.createElement('p');
                p.innerText = `${prediction.class} - ${Math.round(prediction.score * 100)}% confidence`;
                predictionsDiv.appendChild(p);
            });

            // Repeat the detection
            requestAnimationFrame(() => detectObjects(model));
        }

        img.onload = () => {
            loadModel();
        };
    </script>
</body>
</html>
